---
title: '#USL_P1_477001'
output: html_document
date: "2025-12-20"
---
# USL Project 1 
Expected output is to do a choose athe most suitable clustering method, do the cluestering and then forecasting. 

```{r libraries, include=FALSE}
# Install missing libraries on local machine
# install.packages("NbClust")
# Load other necessary and already installed libraries
library(tidyverse)
library(cluster)     # For clustering algorithms
library(factoextra)  # For beautiful clustering plots
library(corrplot)    # For correlation matrices
library(NbClust)     # For optimal k calculation
```

# 1. Introduction
The goal of this project is to cluster countries based on their per-capita energy consumption mix. Unlike a static snapshot, we are using the full dataset (all years) to identify "Energy Regimes" that countries have passed through or are currently in.


# 2. Data Preparation & Cleaning
First, we load the data and remove regional aggregates. We only want individual countries (those with an ISO Code).

```{r load data, include=TRUE}
# Load the raw data
energy_raw <- read.csv("per-capita-energy-stacked.csv", stringsAsFactors = FALSE)

# 1. Filter: Keep only countries (where Code is not empty)
energy_clean <- energy_raw %>%
  filter(Code != "" & !is.na(Code))

# 2. Define the energy source columns and rename them for easier reference
energy_cols <- c("coal_per_capita__kwh", "oil_per_capita__kwh", "gas_per_capita__kwh", 
                 "nuclear_per_capita__kwh__equivalent", "hydro_per_capita__kwh__equivalent", 
                 "wind_per_capita__kwh__equivalent", "solar_per_capita__kwh__equivalent", 
                 "other_renewables_per_capita__kwh__equivalent")
energy_cols_renamed <- c(
  "Coal", "Oil", "Gas", "Nuclear",
  "Hydropower", "Wind", "Solar", "Other renewables"
)

# 3. Handle Missing Values: Replace NA with 0
# Logic: If a source is missing for a country in 1970, consumption was likely zero.
energy_clean <- energy_clean %>%
  mutate(across(all_of(energy_cols), ~replace_na(., 0)))

# 4. Rename the columns for easier reference
energy_clean_renamed <- energy_clean %>%
  rename(
    Coal = coal_per_capita__kwh,
    Oil = oil_per_capita__kwh,
    Gas = gas_per_capita__kwh,
    Nuclear = nuclear_per_capita__kwh__equivalent,
    Hydropower = hydro_per_capita__kwh__equivalent,
    Wind = wind_per_capita__kwh__equivalent,
    Solar = solar_per_capita__kwh__equivalent,
    `Other renewables` = other_renewables_per_capita__kwh__equivalent
  )

dim(energy_raw) # 6585   11, includes whole continents and regions
dim(energy_clean_renamed) # 5925 values/cells   11 columns (only countries)

```
We got 5925 values in 11 columns. Data are more or less ready for EDA. 


# 3. Massive Exploratory Data Analysis (EDA)
## 3.1. Global Energy Development Over Time
To justify clustering all years, we look at how the average global energy mix has evolved.

```{r EDA, include=TRUE}
global_trend <- energy_clean_renamed %>%
  group_by(Year) %>%
  summarise(across(all_of(energy_cols_renamed), mean)) %>%
  pivot_longer(-Year, names_to = "Source", values_to = "Usage")

ggplot(global_trend, aes(x = Year, y = Usage, fill = Source)) +
  geom_area(alpha = 0.8) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3") +
  labs(title = "Evolution of Global Average Energy Mix (1965-2024)",
       subtitle = "Average per capita consumption across all countries",
       y = "kWh per capita", x = "Year")

```
*Interpretation:* The global energy mix has changed significantly over the decades, with fossil fuels dominating until recent years when renewables started to gain traction. Sure visible phase-out of coal and replacement by gas, nuclear and renewables. We face a slight downward trend in energy consumption per capita in the last decade, possibly due to efficiency improvements and slight deindustrialization in some regions (USA, Europe).

General result to see how looks the total energy consumption per capita by source over time. Similar to the total Energy consumption by source visualized below and accessible here: https://ourworldindata.org/energy-mix. 

```{r total energy consumption image}
knitr::include_graphics("Energy consumption by source, World.png")

# Link: https://ourworldindata.org/energy-mix
```


*Interpretation:* We see a massive growth in Fossil Fuels (Oil, Gas, Coal) until the early 2000s, followed by the visible "wedge" of Renewables (Wind, Solar) appearing in the last decade.

## 3.2. Distribution and Outliers
Energy consumption is highly unequal. We use boxplots to see the "spread" of each source.

```{R outliers, inlude=TRUE}
energy_clean_renamed %>%
  select(all_of(energy_cols_renamed)) %>%
  pivot_longer(cols = everything(), names_to = "Source", values_to = "Value") %>%
  ggplot(aes(x = Source, y = Value, fill = Source)) +
  geom_boxplot() +
  coord_flip() +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Distribution of Energy Sources", subtitle = "Extreme outliers in Fossil Fuels")
```

## 3.3. Correlation Matrix
We check if any energy sources are "linked." For example, do countries that use a lot of Gas also use a lot of Oil?

Are fossil sources of energy correlated to each other? Are renewable sources correlated to each other? Indeed, at least a bit. 

```{r correlation matrix, include=TRUE}
cor_matrix <- cor(energy_clean_renamed[, energy_cols_renamed])
corrplot(cor_matrix, method = "color", type = "upper", addCoef.col = "black", 
         tl.col = "black", tl.srt = 45, number.cex = 0.7)
```

*Interpretation:* There are moderate positive correlations among fossil fuels (Coal, Oil, Gas) and among renewables (Wind, Solar, Other renewables). Nuclear and Hydropower show weaker correlations with other sources.